<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        run_antlr = async function() {
            var g = $('#grammar').val();
            var lg = $('#lexgrammar').val();
            var I = $('#input').text();
            var s = $('#start').val();
            // console.log(I)
            // console.log(s)

            const res = await axios.post("http://localhost:8080/antlr/",
                null, // null data
                { params: { grammar: g, lexgrammar: lg, input: I, start:s } })
                .then(function (response) {
                    // handle success
                    console.log(response.data.result);

                    if ( response.data.parser_grammar_errors.length>0 ||
                        response.data.lexer_grammar_errors.length>0 ||
                        response.data.warnings.length>0 ) {
                        $("#console").text(
                            JSON.stringify(response.data.parser_grammar_errors) + "\n" +
                            JSON.stringify(response.data.lexer_grammar_errors) + "\n" +
                            JSON.stringify(response.data.warnings)
                        );
                    }
                    else {
                        $("#console").text("");
                    }
                })
        }
    </script>
</head>
<body>

    <P>
<TEXTAREA name="grammar" id="grammar" rows="10" cols="40">
parser grammar ExprParser;
options { tokenVocab=ExprLexer; }

program
    : stat EOF
    | def EOF
    ;

stat: ID '=' expr ';'
    | expr ';'
    ;

def : ID '(' ID (',' ID)* ')' '{' stat* '}' ;

expr: ID
    | INT
    | func
    | 'not' expr
    | expr 'and' expr
    | expr 'or' expr
    ;

func : ID '(' expr (',' expr)* ')' ;
</TEXTAREA>

<TEXTAREA name="lexgrammar" id="lexgrammar" rows="10" cols="40">
lexer grammar ExprLexer;

AND : 'and' ;
OR : 'or' ;
NOT : 'not' ;
EQ : '=' ;
COMMA : ',' ;
SEMI : ';' ;
LPAREN : '(' ;
RPAREN : ')' ;
LCURLY : '{' ;
RCURLY : '}' ;

INT : [0-9]+ ;
ID: [a-zA-Z_][a-zA-Z_0-9]* ;
WS: [ \t\n\r\f]+ -> skip ;
</TEXTAREA>
            </P>
<p>
    <div id="input" contenteditable="true" style="border:1px solid darkgray">
        <span title="oooooo">f(x, y, z)</span> { x = x and y or z; g(30); }
    </div>
</p>
    <INPUT type="text" id="start" name="start" value="program">
    <br>
    <br>
    <button type="button" onclick="run_antlr()">RUN</button>

<br>
<br>
    <div id="console"></div> <!-- tool errors -->
</body>
</html>

